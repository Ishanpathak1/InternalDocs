---
import BaseLayout from '../layouts/BaseLayout.astro';
const user = Astro.locals.user ?? null;
if (user) {
  return Astro.redirect('/docs');
}
const error = Astro.url.searchParams.get('error');
const setOk = Astro.url.searchParams.get('set') === '1';
const errorMessage =
  error === 'missing'
    ? 'Please fill in code, email, and start date.'
    : error === 'invalid'
      ? 'Invalid or already used access code.'
      : error === 'session'
        ? 'Session link expired. Please sign in again.'
        : error === 'badlogin'
          ? 'Invalid email or password.'
          : null;
---
<BaseLayout title="Login" showNav={true} user={null}>
  <div class="mx-auto max-w-md space-y-6">
    {setOk && (
      <div class="rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-800 dark:border-green-800 dark:bg-green-900/30 dark:text-green-200" role="status">
        Password set. You can log in now.
      </div>
    )}
    {errorMessage && (
      <div class="rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-800 dark:bg-red-900/30 dark:text-red-200" role="alert">
        {errorMessage}
      </div>
    )}

    <section class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-600 dark:bg-slate-800">
      <h2 class="text-lg font-bold text-slate-900 dark:text-slate-100">I already have an account</h2>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-400">Log in with your email and password.</p>
      <form action="/api/login" method="post" class="mt-4 space-y-4">
        <input type="hidden" name="code" value="" />
        <div>
          <label for="login-email" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Email</label>
          <input
            type="email"
            id="login-email"
            name="email"
            required
            autocomplete="email"
            class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
            placeholder="you@company.com"
          />
        </div>
        <div>
          <label for="login-password" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Password</label>
          <input
            type="password"
            id="login-password"
            name="password"
            required
            autocomplete="current-password"
            class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
            placeholder="Your password"
          />
        </div>
        <button
          type="submit"
          class="w-full rounded bg-slate-800 px-4 py-2 font-medium text-white hover:bg-slate-700 dark:bg-slate-600 dark:hover:bg-slate-500"
        >
          Log in
        </button>
      </form>
    </section>

    <section class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-600 dark:bg-slate-800">
      <h2 class="text-lg font-bold text-slate-900 dark:text-slate-100">New user: sign up with access code</h2>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-400">
        Enter your one-time access code and details to create your account. Set a password so you can log in later.
      </p>
    <form action="/api/login" method="post" class="mt-4 space-y-4">
      <div>
        <label for="code" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Access code</label>
        <input
          type="text"
          id="code"
          name="code"
          required
          autocomplete="one-time-code"
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
          placeholder="Paste the code you received"
        />
      </div>
      <div>
        <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          autocomplete="email"
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
          placeholder="you@company.com"
        />
      </div>
      <div>
        <label for="role" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Role</label>
        <input
          type="text"
          id="role"
          name="role"
          value="member"
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
          placeholder="e.g. developer, member"
        />
      </div>
      <div>
        <label for="startDate" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Start date</label>
        <input
          type="date"
          id="startDate"
          name="startDate"
          required
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
        />
      </div>
      <div>
        <label for="githubUrl" class="block text-sm font-medium text-slate-700 dark:text-slate-300">GitHub profile (optional)</label>
        <input
          type="url"
          id="githubUrl"
          name="githubUrl"
          autocomplete="url"
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
          placeholder="https://github.com/username"
        />
      </div>
      <div>
        <label for="signup-password" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Password (for future logins)</label>
        <input
          type="password"
          id="signup-password"
          name="signup-password"
          autocomplete="new-password"
          class="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500 dark:border-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:focus:ring-slate-400"
          placeholder="Choose a password so you can log in later"
        />
      </div>
      <button
        type="submit"
        class="w-full rounded bg-slate-800 px-4 py-2 font-medium text-white hover:bg-slate-700 dark:bg-slate-600 dark:hover:bg-slate-500"
      >
        Create account
      </button>
    </form>
    </section>
  </div>
</BaseLayout>
