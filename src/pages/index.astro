---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const MAIN_CATEGORIES = ['HFNY', 'Kinship', 'OCFS Prevention', 'PICHC', 'IT Dept Management', 'Need help'];

function categoryToSlug(cat) {
  return String(cat)
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^a-z0-9-]/g, '')
    .replace(/-+/g, '-')
    .replace(/^-|-$/g, '') || 'general';
}


const allDocs = await getCollection('docs');
const categories = MAIN_CATEGORIES;
const byCategory = (cat) =>
  allDocs.filter((d) => (d.data.categories ?? []).some((c) => String(c).trim() === cat)).length;
---
<BaseLayout title="CHSR Docs" showNav={true}>
  <div class="mx-auto max-w-4xl">
    <header class="mb-10">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100">CHSR Docs</h1>
      <p class="mt-2 text-slate-600 dark:text-slate-400">
        Pick a category to see its docs, or <a href="/docs" class="text-slate-800 underline dark:text-slate-200">view all docs</a>.
      </p>
    </header>

    <div class="grid gap-4 sm:grid-cols-2">
      {categories.map((cat) => {
        const count = byCategory(cat);
        const slug = categoryToSlug(cat);
        return (
          <a
            href={`/docs/category/${slug}`}
            class="block rounded-xl border border-slate-200 bg-white p-6 shadow-sm transition-colors hover:border-slate-300 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:hover:border-slate-500 dark:hover:bg-slate-700/50"
          >
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">{cat}</h2>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">
              {count} {count === 1 ? 'doc' : 'docs'}
            </p>
            <p class="mt-2 text-sm text-slate-600 dark:text-slate-400">
              View all {cat} documentation â†’
            </p>
          </a>
        );
      })}
    </div>

    <p class="mt-10 text-center text-sm text-slate-500 dark:text-slate-400">
      <a href="/docs/category/need-help" class="underline">Need help?</a> Welcome and How to add a doc are in the Need help category.
    </p>
  </div>
</BaseLayout>
